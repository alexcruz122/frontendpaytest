<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Webxpay Test</title>
</head>
<body>
  <h2>Webxpay Payment Test</h2>
  <button id="payButton">Pay Now</button>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const payButton = document.getElementById("payButton");
      if (!payButton) return;

      // Your Cloudflare Worker URL
      const workerUrl = "https://webxpay-backend.dilankafernando-social.workers.dev";

      payButton.addEventListener("click", async () => {
        try {
          const orderId = "TEST" + Date.now(); // unique order ID
          const amount = 100; // test amount
          const currency = "LKR";

          console.log("Sending payment request...");

          const response = await fetch(`${workerUrl}/create-payment`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ order_id: orderId, amount, currency })
          });

          if (!response.ok) {
            console.error("Worker returned HTTP error:", response.status);
            const text = await response.text();
            console.log("Response body:", text);
            alert("Error occurred. Check console.");
            return;
          }

          const data = await response.json().catch(() => null);
          console.log("Worker Response:", data);

          if (!data) {
            alert("No JSON response from Worker. Check console.");
            return;
          }

          // Redirect if Webxpay returns a URL
          if (data.redirect_url) {
            window.location.href = data.redirect_url;
          } else {
            alert("Payment request sent. Check console for Worker response.");
          }

        } catch (err) {
          console.error("Error calling Worker:", err);
          alert("Error occurred. Check console.");
        }
      });
    });
  </script>
</body>
</html>
